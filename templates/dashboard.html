<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Dashboard</title>
</head>
<body>
  <h2>Дашборды</h2>

  <form id="upload-form" enctype="multipart/form-data">
    <input type="file" id="csv-file" name="file" accept=".csv" required />
    <button type="submit">Загрузить CSV и создать дашборд</button>
    <span id="upload-status"></span>
  </form>
  
  <button id="btn-topic">Показать дашборд по тематикам</button>
  <button id="btn-sentiment" style="margin-left: 8px;">Показать дашборд по сентиментам</button>
  <button id="btn-emotion" style="margin-left: 8px;">Показать дашборд по эмоциям</button>
  
  <div style="margin-top: 16px;">
    <img id="chart-topic" alt="Topic chart" style="max-width: 100%; display:none;" />
    <img id="chart-sentiment" alt="Sentiment chart" style="max-width: 100%; display:none; margin-top: 16px;" />
    <img id="chart-emotion" alt="Sentiment chart" style="max-width: 100%; display:none; margin-top: 20px;" />
  </div>

  <script>
    document.getElementById("btn-topic").addEventListener("click", () => {
      const imgTopic = document.getElementById("chart-topic");
      imgTopic.src = "/dashboard/topic-pie.png?t=" + Date.now();
      imgTopic.style.display = "block";
    });

    document.getElementById("btn-sentiment").addEventListener("click", () => {
      const imgSent = document.getElementById("chart-sentiment");
      imgSent.src = "/dashboard/sentiment-pie.png?t=" + Date.now();
      imgSent.style.display = "block";
    });

    document.getElementById("btn-emotion").addEventListener("click", () => {
    const img = document.getElementById("chart-emotion");
    img.src = "/dashboard/emotion-bubble.png?t=" + Date.now();
    img.style.display = "block";
    });

    document.getElementById("upload-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const fileInput = document.getElementById("csv-file");
      if (!fileInput.files.length) return;

      const form = new FormData();
      form.append("file", fileInput.files[0]);

      const status = document.getElementById("upload-status");
      status.textContent = "Загрузка...";

      const resp = await fetch("/dashboard/upload", { method: "POST", body: form });

      if (resp.redirected) {
        window.location.href = resp.url;
        return;
      }

      status.textContent = resp.ok ? "Загружено" : "Ошибка загрузки";
  </script>

</body>
</html>